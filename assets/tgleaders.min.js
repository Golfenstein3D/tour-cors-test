var tgleaders={debug:location.hostname!=="tour.topgolf.com",baseUrl:function(){return"https://leaders."+(location.hostname==="localhost"?"loc.topgolfmedia.com:3443":"topgolfmedia.com")}(),tid:function(id,yr){var year=yr||(new Date).getFullYear().toString().substr(2);return"tour"+year+id},fetch:function(key,callback){if(!key)return;var busta=Math.ceil(Date.now()/1e3/60/60),url=this.baseUrl+"/json/"+key+"?"+busta;$.get(url).done(function(data){callback(null,data)}).fail(function(xhr,status,err){callback(err,null)})},clear:function(roundNo){var $table=$("#leadersR"+roundNo+" table");$table.slideUp(250,function(){$table.html("")})},clearBracket:function(){var $bracket=$("#bracket div"),$leaders=$("#leaders");$bracket.slideUp(250,function(){$bracket.html("")});$leaders.slideUp(250,function(){$leaders.html("")})},display:function(tourneyId,roundNo){var key="leaders_"+tourneyId+"_r"+roundNo;tgleaders.fetch(key,function(err,json){if(err){console.warn(err);tgleaders.clear(roundNo);return}if(json&&json.leaders){var template=Handlebars.compile(json.leaders.template);var html=template({data:json.leaders.data});$("#leadersR"+roundNo+" table").html(html).fadeIn()}})},displayAll:function(tourneyId,roundNo){tgleaders.clearBracket();for(var r=3;r>0;r--){if(r<=roundNo){tgleaders.display(tourneyId,r)}else{tgleaders.clear(r)}}},displayBracket:function(tourneyId,roundNo){if(tgleaders.debug)console.log("displayBracket",tourneyId,roundNo);var key="bracket_"+tourneyId;if(roundNo&&roundNo<4){key+="_r"+roundNo}tgleaders.fetch(key,function(err,json){if(err){console.warn(err);tgleaders.clearBracket();return}for(var r=3;r>0;r--){tgleaders.clear(r)}if(tgleaders.debug)console.log("json",json);if(!json){return}var bracket=json.bracket;if(bracket&&bracket.data){if(tgleaders.debug)console.log("bracket",bracket.data);if(bracket.data.r1){var bracketTemplate=bracket.template.indexOf("<")===0?bracket.template:$("#bracket-template").html(),bracketTmpl=Handlebars.compile(bracketTemplate),bracketHtml=bracketTmpl(bracket.data);$("#bracket div").html(bracketHtml).fadeIn();$(".r1,.r2,.r3").find(".matchup").each(function(m,matchup){var $matchupDivs=$(matchup).children("div"),$team1Boxes=$($matchupDivs[0]).find(".score"),$team2Boxes=$($matchupDivs[1]).find(".score");var scoreCount=Math.min($team1Boxes.length,$team2Boxes.length),tie="tie",top="top";for(var s=0;s<scoreCount;s++){var $team1Box=$($team1Boxes[s]),$team2Box=$($team2Boxes[s]),team1Score=parseInt($team1Box.text())||0,team2Score=parseInt($team2Box.text())||0;if(team1Score&&team2Score){if(team1Score>team2Score){$team1Box.removeClass(tie).addClass(top)}else if(team2Score>team1Score){$team2Box.removeClass(tie).addClass(top)}else{$team1Box.removeClass(top).addClass(tie);$team2Box.removeClass(top).addClass(tie)}}else{$team1Box.removeClass(tie+" "+top);$team2Box.removeClass(tie+" "+top)}}})}}})},pageInit:function($element){var id=$element.data("id"),yr=$element.data("yr"),roundNo=parseInt($element.data("rn"))||0;if(id&&roundNo){var tourneyId=tgleaders.tid(id,yr);if(tourneyId.startsWith("tour")&&tourneyId.endsWith("final")){tgleaders.displayBracket(tourneyId,roundNo)}else{tgleaders.displayAll(tourneyId,roundNo)}}}};$(function(){tgleaders.pageInit($("#results"));$(".venue-col a").on("click",function(){var $link=$(this),id=$link.data("id"),yr=$link.data("yr"),roundNo=parseInt($link.data("rn"))||0;if(id&&roundNo){var tourneyId=tgleaders.tid(id,yr);if(tourneyId.startsWith("tour")&&tourneyId.endsWith("final")){tgleaders.displayBracket(tourneyId,roundNo)}else{tgleaders.displayAll(tourneyId,roundNo)}return false}return true})});